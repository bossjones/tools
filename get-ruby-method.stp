# @ton31337
global count;
global pids;

probe process("/opt/rbenv/versions/2.2.0/bin/ruby").function("rb_call0").return
{
        count[$mid]++;
        pids[$mid] = pid();
}

probe timer.s(5)
{
        ansi_clear_screen();
        foreach(mid in count- limit 2) {
                system(sprintf("gdb -p %d --batch -ex 'call rb_id2name(%d)' | awk '{ if($0 ~ /^\$/) print $4; }'",
                          pids[mid], mid))
        }
}
